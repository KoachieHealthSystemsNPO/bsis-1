    <dropForeignKeyConstraint baseTableName="BloodTestingRule" constraintName="fk_BloodTestingRule_BloodTest"/>
    <dropForeignKeyConstraint baseTableName="BloodTestingRule_BloodTest" constraintName="fk_BloodTestingRule_BloodTest_BloodTest"/>
    <dropForeignKeyConstraint baseTableName="BloodTestResult" constraintName="fk_BloodTestResult_BloodTest"/>

    <addColumn tableName="BloodTest">
      <column name="id_temp" type="BIGINT" afterColumn="id"/>
    </addColumn>

    <addColumn tableName="BloodTest_AUD">
      <column name="id_temp" type="BIGINT" afterColumn="id"/>
    </addColumn>

    <addColumn tableName="BloodTestingRule">
      <column name="bloodTest_id_temp" type="BIGINT" afterColumn="bloodTest_id"/>
    </addColumn>

    <addColumn tableName="BloodTestingRule_BloodTest">
      <column name="pendingBloodTests_id_temp" type="BIGINT" afterColumn="pendingBloodTests_id"/>
    </addColumn>

    <addColumn tableName="BloodTestResult">
      <column name="bloodTest_id_temp" type="BIGINT" afterColumn="bloodTest_id"/>
    </addColumn>

    <addColumn tableName="BloodTestingRule_AUD">
      <column name="bloodTest_id_temp" type="BIGINT" afterColumn="bloodTest_id"/>
    </addColumn>

    <addColumn tableName="BloodTestResult_AUD">
      <column name="bloodTest_id_temp" type="BIGINT" afterColumn="bloodTest_id"/>
    </addColumn>

    <sql>
      UPDATE BloodTest 
      SET id_temp = id;
    </sql>

    <!-- Create Index on temporary id_temp field to make updates referencing it more efficient. -->
    <createIndex indexName="bloodtest_id_temp_index" tableName="BloodTest" unique="true">
        <column name="id_temp" type="BIGINT"/>
    </createIndex>

    <sql>
      UPDATE BloodTest_AUD 
      SET id_temp = id;
    </sql>

    <sql>
      UPDATE BloodTestingRule_AUD 
      SET bloodTest_id_temp = bloodTest_id;
    </sql>

    <sql>
      UPDATE BloodTestResult_AUD 
      SET bloodTest_id_temp = bloodTest_id;
    </sql>

    <sql>
      UPDATE BloodTestingRule 
      SET bloodTest_id_temp = bloodTest_id;
    </sql>

    <sql>
      UPDATE BloodTestingRule_BloodTest 
      SET pendingBloodTests_id_temp = pendingBloodTests_id;
    </sql>

    <sql>
      UPDATE BloodTestResult 
      SET bloodTest_id_temp = bloodTest_id;
    </sql>

    <!-- Remove auto increment from the existing id column -->
    <modifyDataType columnName="id" newDataType="BIGINT(20)" tableName="BloodTest"/>

    <modifyDataType columnName="id" newDataType="BINARY(16)" tableName="BloodTest"/>

    <modifyDataType columnName="id" newDataType="BINARY(16)" tableName="BloodTest_AUD"/>

    <modifyDataType columnName="bloodTest_id" newDataType="BINARY(16)" tableName="BloodTestingRule"/>
    <modifyDataType columnName="pendingBloodTests_id" newDataType="BINARY(16)" tableName="BloodTestingRule_BloodTest"/>
    <modifyDataType columnName="bloodTest_id" newDataType="BINARY(16)" tableName="BloodTestResult"/>

    <modifyDataType columnName="bloodTest_id" newDataType="BINARY(16)" tableName="BloodTestingRule_AUD"/>
    <modifyDataType columnName="bloodTest_id" newDataType="BINARY(16)" tableName="BloodTestResult_AUD"/>

    <sql>
      UPDATE BloodTest 
      SET id = GENERATEBINARYUUID()
      ORDER BY id_temp;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTest ADD id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(id,  1, 4)),
        HEX(SUBSTR(id,  5, 2)),
        HEX(SUBSTR(id,  7, 2)),
        HEX(SUBSTR(id,  9, 2)),
        HEX(SUBSTR(id, 11)) )))
      VIRTUAL AFTER id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTest_AUD ADD id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(id,  1, 4)),
        HEX(SUBSTR(id,  5, 2)),
        HEX(SUBSTR(id,  7, 2)),
        HEX(SUBSTR(id,  9, 2)),
        HEX(SUBSTR(id, 11)) )))
      VIRTUAL AFTER id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTestingRule_AUD ADD bloodTest_id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(bloodTest_id,  1, 4)),
        HEX(SUBSTR(bloodTest_id,  5, 2)),
        HEX(SUBSTR(bloodTest_id,  7, 2)),
        HEX(SUBSTR(bloodTest_id,  9, 2)),
        HEX(SUBSTR(bloodTest_id, 11)) )))
      VIRTUAL AFTER bloodTest_id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTestResult_AUD ADD bloodTest_id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(bloodTest_id,  1, 4)),
        HEX(SUBSTR(bloodTest_id,  5, 2)),
        HEX(SUBSTR(bloodTest_id,  7, 2)),
        HEX(SUBSTR(bloodTest_id,  9, 2)),
        HEX(SUBSTR(bloodTest_id, 11)) )))
      VIRTUAL AFTER bloodTest_id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTestingRule ADD bloodTest_id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(bloodTest_id,  1, 4)),
        HEX(SUBSTR(bloodTest_id,  5, 2)),
        HEX(SUBSTR(bloodTest_id,  7, 2)),
        HEX(SUBSTR(bloodTest_id,  9, 2)),
        HEX(SUBSTR(bloodTest_id, 11)) )))
      VIRTUAL AFTER bloodTest_id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTestingRule_BloodTest ADD pendingBloodTests_id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(pendingBloodTests_id,  1, 4)),
        HEX(SUBSTR(pendingBloodTests_id,  5, 2)),
        HEX(SUBSTR(pendingBloodTests_id,  7, 2)),
        HEX(SUBSTR(pendingBloodTests_id,  9, 2)),
        HEX(SUBSTR(pendingBloodTests_id, 11)) )))
      VIRTUAL AFTER pendingBloodTests_id;
    </sql>

    <sql dbms="mysql">
      ALTER TABLE BloodTestResult ADD bloodTest_id_text varchar(36) GENERATED ALWAYS AS (LCASE(CONCAT_WS('-', 
        HEX(SUBSTR(bloodTest_id,  1, 4)),
        HEX(SUBSTR(bloodTest_id,  5, 2)),
        HEX(SUBSTR(bloodTest_id,  7, 2)),
        HEX(SUBSTR(bloodTest_id,  9, 2)),
        HEX(SUBSTR(bloodTest_id, 11)) )))
      VIRTUAL AFTER bloodTest_id;
    </sql>

    <sql>
      UPDATE BloodTest_AUD AS updateTable
        LEFT JOIN BloodTest AS joinTable ON (updateTable.id_temp = joinTable.id_temp)
      SET updateTable.id = joinTable.id
      WHERE joinTable.id IS NOT null; 
    </sql>

    <!-- Delete orphaned rows from Audit table. These values uuids cannot be found since the rows were deleted in the original table-->
    <sql>
      DELETE BloodTest_AUD
      FROM BloodTest_AUD
        LEFT JOIN BloodTest AS joinTable ON (BloodTest_AUD.id = joinTable.id)
      WHERE joinTable.id IS null
    </sql>

    <sql>
      UPDATE BloodTestingRule AS updateTable
        LEFT JOIN BloodTest AS joinedTable ON (updateTable.bloodTest_id_temp = joinedTable.id_temp)
      SET updateTable.bloodTest_id = joinedTable.id 
      WHERE joinedTable.id IS NOT null; 
    </sql>

    <sql>
      UPDATE BloodTestingRule_BloodTest AS updateTable
        LEFT JOIN BloodTest AS joinedTable ON (updateTable.pendingBloodTests_id_temp = joinedTable.id_temp)
      SET updateTable.pendingBloodTests_id = joinedTable.id 
      WHERE joinedTable.id IS NOT null; 
    </sql>

    <sql>
      UPDATE BloodTestResult AS updateTable
        LEFT JOIN BloodTest AS joinedTable ON (updateTable.bloodTest_id_temp = joinedTable.id_temp)
      SET updateTable.bloodTest_id = joinedTable.id 
      WHERE joinedTable.id IS NOT null; 
    </sql>

    <sql>
      UPDATE BloodTestingRule_AUD AS updateTable
        LEFT JOIN BloodTest AS joinedTable ON (updateTable.bloodTest_id_temp = joinedTable.id_temp)
      SET updateTable.bloodTest_id = joinedTable.id 
      WHERE joinedTable.id IS NOT null; 
    </sql>

    <sql>
      UPDATE BloodTestResult_AUD AS updateTable
        LEFT JOIN BloodTest AS joinedTable ON (updateTable.bloodTest_id_temp = joinedTable.id_temp)
      SET updateTable.bloodTest_id = joinedTable.id 
      WHERE joinedTable.id IS NOT null; 
    </sql>

    <dropColumn columnName="id_temp" tableName="BloodTest"/>

    <dropColumn columnName="id_temp" tableName="BloodTest_AUD"/>

    <dropColumn columnName="bloodTest_id_temp" tableName="BloodTestingRule"/>

    <dropColumn columnName="pendingBloodTests_id_temp" tableName="BloodTestingRule_BloodTest"/>

    <dropColumn columnName="bloodTest_id_temp" tableName="BloodTestResult"/>

    <dropColumn columnName="bloodTest_id_temp" tableName="BloodTestingRule_AUD"/>

    <dropColumn columnName="bloodTest_id_temp" tableName="BloodTestResult_AUD"/>

    <addForeignKeyConstraint baseColumnNames="bloodTest_id" baseTableName="BloodTestingRule" constraintName="fk_BloodTestingRule_BloodTest"
      referencedColumnNames="id" referencedTableName="BloodTest"/>

    <addForeignKeyConstraint baseColumnNames="pendingBloodTests_id" baseTableName="BloodTestingRule_BloodTest" constraintName="fk_BloodTestingRule_BloodTest_BloodTest"
      referencedColumnNames="id" referencedTableName="BloodTest"/>

    <addForeignKeyConstraint baseColumnNames="bloodTest_id" baseTableName="BloodTestResult" constraintName="fk_BloodTestResult_BloodTest"
      referencedColumnNames="id" referencedTableName="BloodTest"/>

